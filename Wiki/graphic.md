# Graphic Related Commands

```
LoadCharacter 02 04 03
```

**LoadCharacter** is used to load a character sprite.

This action does not hide the nvl window during loading the character.

The first parameter is the position - 0 is left, 1 is center, 2 is right.

The filename is generated by this expression:

"C" + (( parameter 2 << 8 ) | parameter 3)

If the resulted number is 0xFFFF then we clear the sprite on that position and return.

There is a special case for Akari sprites:

```c
void
ToHeartLoadCharacter(Lvns *lvns, int no, int pos)
{
    /* ... */
    if ((no >> 8) == 0)
    {
        if ((state->flag[TOHEART_FLAG_AKARI] & 0x01)) {
            no |= 0x80;
        }
        no |= 0x100;
    }
    /* ... */
}
```

```
ChangeCharacter 02 04 03
```

**ChangeCharacter** takes the same parameters as the **LoadCharacter**, but it also:
1. Hide the nvl window
2. Use the **LoadCharacter** function effectively changing the displayed character.
3. Shows the nvl window again

NOTE: **LoadCharacterC2** seems to do basically the same thing as the **ChangeCharacter**. It's invoked only once in the whole game (0530.SCN.TEXT).

```
ClearCharacter 03
```

**ClearCharacter** will clear the character on the specified position. If a 3 is passed as a parameter then it will clear every character. It does not affect the nvl window.

```
ClearAndLoadCharacter 01 00 0A
```

In this function:
1. We hide the nvl window
2. We use the ClearCharacter with parameter 3 - clears every character
3. Displays the character with the parameters passed like in the LoadCharacter
4. Shows again the nvl window

```
LoadCharacterAndBg 02 1e 09 14 0b 00
```

In this function:
1. We hide the nvl window
2. We clear the screen (to black) with the fifth parameter
3. We load the BG with the forth parameter
4. We load the character with position as first parameter and the computed file name with second and third parameter
5. We transition to the computed screen with the sixth parameter.

```
LoadThreeCharacters 00 1c 01 02 ff ff 01 ff ff
```

In this function:
1. We hide the nvl window.
2. We load the first character with first parameter as position and second and third to compute the filename.
3. We load the second character with forth parameter as position and fifth and sixth to compute the filename.
4. We load the third character with seventh parameter as position and eight and ninth to compute the filename.
5. All the loading should be done one after another. #TODO: Check
5. We show the nvl window.

```
LoadBG 02
Effect 05
```

The LoadBG takes one parameter and is accompanied by the Effect Command.

This is probably used to transition to the new BG from the current one without going to black. This set of command can also be found a Nazo23 with some values like:

* 0x1E - 030
* 0x32 - 050
* 0x64 - 100
* 0xC8 - 200

I assume it's used as a non standard transition time. Probably expressed in frame count. #TODO: Check

In this function:
1. We create the filename "S" + parameter in hex + ".LF2"
2. There are two weird statements that I will omit (point 3).
3. on the fifth position of the filename we put a new character based on the haikeiflag[] = { 'D', 'E', 'N', 'X', }; => haikeiflag[no / 50].
4. We call the LvnsLoadBackground (filename, number_from_filename % 50)
5. Then we also call the ClearCharacter with the parameter 3.

Basically we would need to first clear the characters before transitioning to a new location. We don't hide or show the nvl window.

```
LoadBG2 15 00 00
```

This function have a similar actions, but in this function:
1. We hide the nvl window.
2. We clear the screen with effect with parameter 2.
3. We load the bg into the memory with the parameter 1.
4. We use the parameter 3 to transition the bg.

```
LoadVisual 11
Effect 00
```

```
LoadVisualScene 00 0A 0B
```

```
LoadHVisualScene
```


# Handling "LoadVisualScene" and "LoadHVisualScene" Command

This command takes one parameter that is the number of the visual in hex.

```c
void
ToHeartLoadVisual(Lvns *lvns, int no)
{
    ToHeartState *state = (ToHeartState *)lvns->system_state;
    lvns->bg_type = LVNS_VISUAL;
    lvns->bg_no   = no;
    if (no == 0) {
        lvnsimage_clear(lvns->background);
    } else {
        /* あかりの髪型処理… */
        if ((no == 0x11 || no == 0x13) && 
            (state->flag[TOHEART_FLAG_AKARI] & 0x01)) {
            no = 0x12;
        }
        /* レミィパンティ */
        if (no == 0x80) {
        }
        LvnsLoadBackground(lvns, "V%02x.LF2", no);
    }
    ToHeartClearCharacter(lvns, 3);
}
```

IMPORTANT NOTE: I think the LoadBG and LoadBG2 even if they do basically the same they are actually used to load from one bg to black and back to new (LoadBG2) while the LoadBG will not go to black.

The same goes for LoadVisual and LoadVisualScene


**Implementation:**

```renpy
label LoadVisual(visual_type = True, num='00'):
    if visual_type:
        scene expression "V[num].png"
        with blinds
    else
        scene expression "H[num].png"
        with blinds

    return
```